{"version":3,"sources":["scripts/preprocess.js","scripts/tooltip.js","scripts/viz4.js","scripts/alluvial.js","scripts/viz1.js","../node_modules/scrollama/build/scrollama.js","scripts/scrolly/network.js","scripts/scrolly.js","index.js","../node_modules/parcel-bundler/src/builtins/hmr-runtime.js"],"names":["data","sankeyData","alluvialData","filteredAlluvialData","companiesFlightArray","topCompaniesCount","companiesAircrafts","topCompaniesSet","Set","setData","newData","setCompaniesFlightCount","setAlluvialData","forEach","d","push","airline","duration","departureTime","flightRange","count","parseInt","filterAlluvialData","index","findIndex","company","found","find","f","otherCount","setSankeyData","airlineDurationCounts","key","durationDepartureCounts","departureFlightCounts","Object","keys","split","source","target","level","getData","getSankeyData","getAlluvialData","getFilteredAlluvialData","getCompaniesFlightArray","getTopCompaniesCount","setTopCompaniesCount","getCompaniesAircraftsMap","groupByMainCompanies","agg","Map","x","has","airportIn","airportOut","keyBis","get","set","parseFloat","number","flyArray","value","Promise","resolve","reject","resizeTopCompagnies","bottomBucket","selection","splice","add","topCompanies","delete","numOthers","sortedCompanies","entries","sort","a","b","setCompaniesAircraftsMap","aircraftsData","aircrafts","opName","type","Tooltip","element","d3","select","append","style","attr","m","html","pageY","text","name","window","innerWidth","category","fraction","total","biggestCompaniesAircrafts","otherCompaniesAircrafts","colorScale","FACTOR","COLUMN_NUMBER","SQUARE_SIZE","INTERGAP_SPACE","tooltip","loadData","on","csv","then","files","preprocess","drawWaffles","initWaffle","separateBigFromOthers","drawOtherCompaniesWaffle","drawTopCompaniesWaffles","addLegend","modifyData","remove","biggestCompaniesFlights","typeCount","createScale","domain","map","scaleOrdinal","range","schemeCategory10","calculateWaffleDimensions","reduce","acc","rows","Math","ceil","otherCompaniesWaffleHeight","width","height","cols","squareSize","offset","waffleify","div","drawWaffle","companyMap","othersCount","length","i","totalPark","waffles","round","selectAll","enter","showTooltipAircrafts","moveTooltip","hideTooltip","legendContainer","legendItems","graph","nodes","links","createAlluvialViz","initAlluvial","extractTimes","svg","sankey","nodeSort","nodeWidth","nodePadding","size","sourceIndex","node","targetIndex","sourceNode","targetNode","x0","y0","lastNode","filter","lastNodeHeight","getBoundingClientRect","y1","x1","event","showAlluvialNode","showTooltipNode","layer","resetAlluvial","link","join","sankeyLinkHorizontal","max","showAlluvialLink","showTooltipLink","bbox","getBBox","y","highlightLinks","alluvialToHighlight","sankeyToHighlight","sd","sum","ad","linkToModify","linkPath","colorPercentage","sourceName","targetName","nameArray","includes","nodeName","BUCKET_HEIGHT","BUCKET_WIDTH","displayBucketGraph","heightScale","createHeightScale","topBucket","setUpSlider","displayTopBucket","displayBottomBucket","slider","document","getElementById","sliderValue","innerHTML","oninput","waffle","alluvial","c","showTooltipTop","toolTipDisplay","flightTotal","showTooltipBottom","maxHeight","scaleLinear","min","Network","ratio","airportCode","levelGeo","null","ccolor","currentGeo","limits","minMaxXGlobal","minMaxYGlobal","log","readAirports","localairports","nb","minMaxX","extent","lat","minMaxY","lon","item","airport","undefined","self","transition","ease","easePolyInOut","circles","scaleSize","freq","showTooltipAirport","country","city","e","continent","easeCubicOut","delay","circlesTooltips","bind","readFlights","localflights","easeCubicInOut","raise","db","lvl","main","scrolly","figure","article","step","figureHeight","innerHeight","scroller","scrollama","handleResize","stepH","floor","figureMarginTop","resize","figWidth","network","handleStepEnter","response","direction","displayAirports","displayFlights","removeAirports","removeFlights","handleStepExit","initNetwork","setup","debug","onStepExit","onStepEnter","onbeforeunload","scrollTo","onload","all","concat","buckets","OVERLAY_ID","OldModule","module","bundle","Module","moduleName","call","hot","hotData","_acceptCallbacks","_disposeCallbacks","accept","fn","dispose","checkedAssets","assetsToAccept","parent","isParcelRequire","WebSocket","hostname","location","protocol","ws","onmessage","JSON","parse","handled","assets","asset","isNew","didAccept","hmrAcceptCheck","global","parcelRequire","id","every","generated","js","console","clear","hmrApply","v","hmrAcceptRun","reload","close","onclose","removeErrorOverlay","error","message","stack","overlay","createErrorOverlay","body","appendChild","createElement","stackTrace","innerText","getParents","modules","parents","k","dep","Array","isArray","Function","deps","cached","cache","some","cb"],"mappings":"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;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AChaA;AACA;AAAwD;AAAA;AAAA;AAAA;AAAA,IAEnCyB,OAAO;EAE1B,iBAAYxE,GAAG,EAAa;IAAA,IAAXyE,KAAK,uEAAG,CAAC;IAAA;IACxB,IAAI,CAACnI,OAAO,GAAG,IAAIxB,gBAAO,EAAE;IAC5B,IAAI,CAAC2J,KAAK,GAAGA,KAAK;IAClB,IAAI,CAACzE,GAAG,GAAGA,GAAG;IACd,IAAI,CAAC0E,WAAW,GAAG,CAAC,CAAC;IACrB,IAAI,CAACC,QAAQ,GAAG;MAAE,CAAC,EAAE,IAAI;MAAE,CAAC,EAAE,IAAI;MAAE,CAAC,EAAE,OAAO;MAAE,CAAC,EAAE,IAAI;MAAE,IAAI,EAAE,CAAC;MAAE,IAAI,EAAE,CAAC;MAAE,OAAO,EAAE,CAAC;MAAEC,IAAI,EAAE;IAAE,CAAC;IAChG,IAAI,CAACC,MAAM,GAAG;MACZ,QAAQ,EAAE,iBAAiB;MAC3B,SAAS,EAAE,mBAAmB;MAC9B,QAAQ,EAAE,iBAAiB;MAC3B,MAAM,EAAE,mBAAmB;MAC3B,SA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","file":"src.e31bb0bc.js","sourceRoot":"..\\src","sourcesContent":["let data = [];\nlet sankeyData = [];\nlet alluvialData = [];\nlet filteredAlluvialData = [];\nlet companiesFlightArray = [];\nlet topCompaniesCount = 0;\nlet companiesAircrafts = [];\n\nlet topCompaniesSet = new Set();\n\nexport function setData(newData) {\n  data = newData\n  companiesFlightArray = setCompaniesFlightCount(data);\n}\n\nexport function setAlluvialData(data) {\n  alluvialData = [];\n  data.forEach(d => {\n    alluvialData.push({airline: d.airline, duration: d.duration, departureTime: d.departureTime, flightRange: d.flightRange, count: parseInt(d.count)});\n  });\n}\n\nexport function filterAlluvialData() {\n  filteredAlluvialData = [];\n\n  alluvialData.forEach(d => {\n    let index = companiesFlightArray.findIndex(company => company[0] === d.airline);\n    if (index >= 0 && index < topCompaniesCount) {\n      filteredAlluvialData.push(d);\n    } else {\n      let found = filteredAlluvialData.find(f => f.duration === d.duration && f.departureTime === d.departureTime && f.flightRange === d.flightRange && f.airline === 'OTHERS');\n      if (found) {\n        found.count += d.count;\n      } else {\n        filteredAlluvialData.push({airline: 'OTHERS', duration: d.duration, departureTime: d.departureTime, flightRange: d.flightRange, count: d.count});\n      }\n    }\n  });\n\n  let index = companiesFlightArray.findIndex(company => company === 'OTHERS');\n  if (index >= 0 && index < topCompaniesCount) {\n    let found = filteredAlluvialData.find(f => f.airline === 'OTHERS');\n    if (found) {\n      found.count += otherCount;\n    } else {\n      filteredAlluvialData.push({airline: 'OTHERS', duration: '', departureTime: '', flightRange: '', count: otherCount});\n    }\n  }\n\n  setSankeyData();\n}\n\n\nexport function setSankeyData() {\n  // 'filteredAlluvialData' is the array of objects containing airline, duration, departureTime, and flightRange\n\n  sankeyData = [];\n  // count objects with same airline and duration\n  const airlineDurationCounts = {};\n  filteredAlluvialData.forEach(d => {\n    const key = `${d.airline}_${d.duration}`;\n    if (!airlineDurationCounts[key]) {\n      airlineDurationCounts[key] = 0;\n    }\n    airlineDurationCounts[key] += d.count;\n  });\n\n  // count objects with same duration and departureTime\n  const durationDepartureCounts = {};\n  filteredAlluvialData.forEach(d => {\n    const key = `${d.duration}_${d.departureTime}`;\n    if (!durationDepartureCounts[key]) {\n      durationDepartureCounts[key] = 0;\n    }\n    durationDepartureCounts[key] += d.count;\n  });\n\n  // count objects with same departureTime and flightRange\n  const departureFlightCounts = {};\n  filteredAlluvialData.forEach(d => {\n    const key = `${d.departureTime}_${d.flightRange}`;\n    if (!departureFlightCounts[key]) {\n      departureFlightCounts[key] = 0;\n    }\n    departureFlightCounts[key] += d.count;\n  });\n\n  Object.keys(airlineDurationCounts).forEach(key => {\n    const [airline, duration] = key.split('_');\n    const source = airline;\n    const target = duration;\n    const count = airlineDurationCounts[key];\n    sankeyData.push({source, target, count, level: 0});\n  });\n  Object.keys(durationDepartureCounts).forEach(key => {\n    const [duration, departureTime] = key.split('_');\n    const source = duration;\n    const target = departureTime;\n    const count = durationDepartureCounts[key];\n    sankeyData.push({source, target, count, level: 1});\n  });\n  Object.keys(departureFlightCounts).forEach(key => {\n    const [departureTime, flightRange] = key.split('_');\n    const source = departureTime;\n    const target = flightRange;\n    const count = departureFlightCounts[key];\n    sankeyData.push({source, target, count, level: 2});\n  });\n\n  return sankeyData;\n}\n\nexport function getData() {\n  return [...data];\n}\n\nexport function getSankeyData() {\n  return [...sankeyData];\n}\n\nexport function getAlluvialData() {\n  return [...alluvialData];\n}\n\nexport function getFilteredAlluvialData() {\n  return [...filteredAlluvialData];\n}\n\nexport function getCompaniesFlightArray() {\n  return [...companiesFlightArray];\n}\n\nexport function getTopCompaniesCount(){\n  return topCompaniesCount;\n}\n\nexport function setTopCompaniesCount(count){\n  topCompaniesCount = count;\n}\n\nexport function getCompaniesAircraftsMap() {\n  return companiesAircrafts;\n}\n\n\nexport function groupByMainCompanies(data) {\n  let agg = new Map()\n  data.forEach(function (x) {\n    if (topCompaniesSet.has(x.company)) { } else {\n      x.company = \"OTHERS\"\n    }\n    let key = [x.company, x.airportIn, x.airportOut]\n    let keyBis = [x.company, x.airportOut, x.airportIn]\n\n    if (agg.get(key)) {\n      agg.set(key, agg.get(key) + parseFloat(x.number))\n    } else if (agg.get(keyBis)) {  \n      agg.set(keyBis, agg.get(keyBis) + parseFloat(x.number))\n    } else {\n      agg.set(key, parseFloat(x.number))\n    }\n  })\n  let flyArray = []\n  agg.forEach(function (value, key) {\n    flyArray.push({ company: key[0], airportIn: key[1], airportOut: key[2], number: value})\n  })\n  return new Promise((resolve, reject) => resolve(flyArray))\n}\n\nexport function resizeTopCompagnies(bottomBucket) {\n  let selection = bottomBucket.splice(0,   topCompaniesCount);\n  selection.forEach(d => topCompaniesSet.add(d[0]))\n  return selection;\n}\n\nfunction setCompaniesFlightCount(data) {\n  const topCompanies = new Map()\n  data.forEach((d) => {\n    if (!topCompanies.get(d.company)) {\n      topCompanies.set(d.company, parseFloat(d.number))\n    }\n    else {\n      topCompanies.set(d.company, topCompanies.get(d.company) + parseFloat(d.number))\n    }\n  })\n  topCompanies.delete('NULL')\n  topCompanies.delete('')\n  let numOthers = topCompanies.get(\"OTHERS\")\n  topCompanies.delete(\"OTHERS\")\n\n  let sortedCompanies = [...topCompanies.entries()].sort((a, b) => b[1] - a[1])\n\n  sortedCompanies.push([\"OTHERS\", numOthers])\n  return sortedCompanies\n}\n\nexport function setCompaniesAircraftsMap(aircraftsData) {\n  const aircrafts = new Map();\n\n  aircraftsData.forEach((d) => {\n      let opName = d.company;\n\n      if (opName == \"\" || opName == \"NULL\") return;\n\n      if (!aircrafts.get(opName)) {\n          if (opName)\n          aircrafts.set(opName, new Map());\n      }\n\n      let type = d.type == '' || d.type == 'NULL' ? 'Inconnu' : d.type;\n\n      if (!aircrafts.get(opName).get(type)) {\n          aircrafts.get(opName).set(type, 1);\n      }\n\n      else {\n          aircrafts.get(opName).set(type, aircrafts.get(opName).get(type) + 1);\n      }\n  })\n  companiesAircrafts = aircrafts;\n\n  return aircrafts;\n  \n}","\nexport default class Tooltip {\n    element;\n\n    constructor() { \n        this.element = d3.select(\"body\")\n            .append(\"div\")\n            .style(\"opacity\", 0)\n            .attr(\"class\", \"tooltip\")\n            .style(\"background-color\", \"black\")\n            .style(\"border-radius\", \"5px\")\n            .style(\"padding\", \"10px\")\n            .style(\"color\", \"white\")\n            .style('position', 'absolute')        \n    }\n\n    showTooltipTop(m, d) {\n        this.element\n            .style(\"opacity\", 1)\n            .html(d[0] + \": \" + d[1] + \" vols\")\n            .style(\"left\", (m.x + 30) + \"px\")\n            .style(\"top\", (m.pageY + 30) + \"px\")\n            .style('width', null)\n\n    }\n\n    showTooltipBottom(m, d) {\n        \n        this.element\n            .style(\"opacity\", 1)\n            .html(\"Prochaines 5 plus grandes compagnies: <br>\" + d)\n            .style(\"left\", (m.x + 30) + \"px\")\n            .style(\"top\", (m.pageY + 30) + \"px\")\n            .style('width', '300px')\n    }\n\n\n    showTooltipLink(m, source, target, value, level) {\n        var text = \"\";\n\n        switch(level) {\n            case 0: \n                text = `${value} vols ${target}-courriers<br>effectués par ${source}`\n                break;\n            case 1:\n                text = `${value} vols ${source}-courriers<br>effectués entre ${target}`\n                break;\n            case 2: \n                text = `${value} vols effectués<br>entre ${source} de desserte ${target}`\n                break;\n        }\n\n        this.element\n            .style(\"opacity\", 0.7)\n            .html(text)\n            .style(\"left\", (m.x + 30) + \"px\")\n            .style(\"top\", (m.pageY + 30) + \"px\")\n    }\n\n\n\n    showTooltipNode(m, name, value, level) {\n        var text = \"\";\n        switch(level) {\n            case 0: \n                text = `${value} vols effectués par ${name}`\n                break;\n            case 1:\n                text = `${value} vols ${name}-courriers`\n                break;\n            case 2: \n                text = `${value} vols effectués entre ${name}`\n                break;\n            default:\n                text = `${value} vols de desserte ${name}`\n                break;\n        }\n\n        this.element\n            .style(\"opacity\", 0.7)\n            .html(text)\n            .style(\"left\", (m.x + 30) + \"px\")\n            .style(\"top\", (m.pageY + 30) + \"px\")\n    }\n\n    showTooltipAirport(m, d) {\n\n        this.element\n            .style(\"opacity\", 0.7)\n            .html(d[0] + \"<br>\" + d[2] + \" - \" + d[1] + \"<br>\"+ d[3] + \" vols\")\n            .style(\"left\", ((m.x > window.innerWidth * 0.5) ? (m.x - 90) : (m.x + 30)) + \"px\")\n            .style(\"top\", (m.pageY + 30) + \"px\")\n    }\n\n    showTooltipAircrafts(m, d) {\n\n        this.element\n            .style(\"opacity\", 1)\n            .html('Aéronef de type: ' + d.category + '<br>' + 'Quantité: ' + d.fraction + ' / ' + d.total)\n            .style(\"left\", (m.x + 30) + \"px\")\n            .style(\"top\", (m.pageY + 30) + \"px\")\n    }\n\n    moveTooltip(m) {\n        this.element\n            .style(\"left\", (m.x + 30) + \"px\")\n            .style(\"top\", (m.pageY + 30) + \"px\")\n    }\n\n    hideTooltip() {\n        this.element.style(\"opacity\", 0)\n    }\n}","import * as preprocess from \"./preprocess.js\"\nimport Tooltip from \"./tooltip.js\"\n\nlet biggestCompaniesAircrafts;\nlet otherCompaniesAircrafts;\nlet colorScale = {}\nconst FACTOR = 5;\nconst COLUMN_NUMBER = 25;\nconst SQUARE_SIZE = 20;\nconst INTERGAP_SPACE = 5;\n\nlet tooltip = new Tooltip();\n\nexport function loadData(){\n\td3.select(\"#viz4\").on(\"mouseover\", null)\n\td3.csv('./aircrafts.csv').then(function (files) {\n\t\tpreprocess.setCompaniesAircraftsMap(files);\n        drawWaffles();\n  })\n  }\n\n  export function initWaffle() {\n\td3.select(\"#viz4\").on(\"mouseover\", loadData)\n  }\n\nexport function drawWaffles() {\n\tseparateBigFromOthers();\n\t\n\tdrawOtherCompaniesWaffle();\n\tdrawTopCompaniesWaffles();\n\taddLegend();\n\n}\n\nexport function modifyData() {\n\td3.select('#viz4').select('#topWaffles').remove();\n\td3.select('#viz4').select('#otherWaffle').remove();\n\td3.select('#viz4').select('.legend').remove();\n\n\tseparateBigFromOthers();\n\t\n\tdrawOtherCompaniesWaffle();\n\tdrawTopCompaniesWaffles();\n\taddLegend();\n\n}\n\nfunction separateBigFromOthers() {\n\tconst biggestCompaniesFlights = preprocess.getCompaniesFlightArray();\n\tconst companiesAircrafts = preprocess.getCompaniesAircraftsMap();\n\tbiggestCompaniesAircrafts = new Map();\n\totherCompaniesAircrafts = new Map();\n\tbiggestCompaniesFlights.forEach((d, index) => {\n\t\tif(index < preprocess.getTopCompaniesCount())\n\t\t\tbiggestCompaniesAircrafts.set(d[0], companiesAircrafts.get(d[0]))\n\t\telse {\n\t\t\tfor (const typeCount of companiesAircrafts.get(d[0])) {\n\t\t\t\tconst name = typeCount[0];\n\n\t\t\t\tif (!otherCompaniesAircrafts.get(name))\n\t\t\t\t\totherCompaniesAircrafts.set(name, 0);\n\t\t\t\totherCompaniesAircrafts.set(\n\t\t\t\t\tname,\n\t\t\t\t\totherCompaniesAircrafts.get(name) + typeCount[1]\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t})\n}\n\nfunction createScale(data) {\n\tconst domain = data.map((d) => {\n\t\treturn d.category;\n\t});\n\tcolorScale = d3.scaleOrdinal().domain(domain).range(d3.schemeCategory10);\n}\n\nfunction calculateWaffleDimensions(data, FACTOR) {\n\tconst total = data.reduce((acc, d) => acc + d.value, 0);\n\t// let cols = Math.floor(Math.sqrt(((total / FACTOR) * width) / height));\n\t//if(cols === 0) cols = 1\n\tconst rows = Math.ceil(total / FACTOR / 25);\n\totherCompaniesWaffleHeight =  rows * SQUARE_SIZE + rows * INTERGAP_SPACE;\n\t\n\treturn {\n\t\twidth: COLUMN_NUMBER * SQUARE_SIZE + COLUMN_NUMBER * INTERGAP_SPACE,\n\t\theight: otherCompaniesWaffleHeight,\n\t\trows,\n\t\tcols: COLUMN_NUMBER,\n\t\tsquareSize: SQUARE_SIZE,\n\t\toffset: INTERGAP_SPACE,\n\t};\n}\n\nfunction drawOtherCompaniesWaffle() {\n\tconst data = waffleify(otherCompaniesAircrafts);\n\tconst div = d3.select(\"#viz4\").append('div').attr('id', 'otherWaffle').append('div').attr('class', 'waffle')\n\t\t\n\tcreateScale(data);\n\tdrawWaffle(data, div);\n\td3.select(\"#otherWaffle\").append('p').attr('class', 'waffleLabel').html(\"AUTRES COMPAGNIES\");\n\n}\n\nfunction drawTopCompaniesWaffles() {\n\td3.select(\"#viz4\")\n\t\t.append(\"div\")\n\t\t.attr('id', 'topWaffles')\n\t\n\tlet index = 0;\n\tbiggestCompaniesAircrafts.forEach((companyMap, name) => {\n\t\tconst div = d3.select(\"#topWaffles\")\n\t\t.append(\"div\")\n\t\t.attr(\"class\", 'waffle')\n\n\t\tdrawWaffle(waffleify(companyMap), div, index);\n\t\td3.select(\"#topWaffles\").append('p').attr('class', 'waffleLabel').html(name);\n\t\tindex++;\n\t});\n\n}\n\nfunction waffleify(data) {\n\tconst newData = [];\n\t[...data.entries()].forEach((d) => {\n\t\tnewData.push({ category: d[0], value: d[1] });\n\t});\n\tnewData.sort((a, b) => b.value - a.value)\n\tlet othersCount = 0;\n\tif(newData.length > 8) {\n\t\tfor(let i = 8; i < newData.length; i++){\n\t\t\tothersCount += newData[i].value;\n\t\t}\n\t}\n\tnewData.splice(8, newData.length - 8);\n\tnewData.push({ category: \"Autres\", value: othersCount })\n\n\n\tlet totalPark = 0;\n\tnewData.forEach((d) => {\n\t\ttotalPark += d.value;\n\t});\n\n\tconst waffles = [];\n\tnewData.forEach((d) => {\n\t\tfor (let i = 0; i < Math.round(d.value / FACTOR); i++) {\n\t\t\twaffles.push({category: d.category, fraction: d.value, total: totalPark});\n\t\t}\n\t});\n\n\treturn waffles;\n}\n\nfunction drawWaffle(waffles, div, index) {\n\tdiv\n\t\t.selectAll('.block')\n\t\t.data(waffles)\n\t\t.enter()\n\t\t.append('div')\n\t\t.attr('background-image', 'url(\\'img/plane-icon.png\\')')\n\t\t.attr('class', 'block')\n\t\t.style('background-color', (d) => {return colorScale(d.category)})\n\t\t.on(\"mouseover\", function (m, d) {\n\t\t\ttooltip.showTooltipAircrafts(m, d);\n\t\t})\n\t\t\n\tdiv.on(\"mousemove\", function (m) {return tooltip.moveTooltip(m)})\n\t\t.on(\"mouseleave\", function () {\n\t\t\treturn tooltip.hideTooltip();\n\t\t});\n\n}\n\n\n\nfunction addLegend() {\n\tconst legendContainer = d3.select('#viz4')\n\t\t.append('svg')\n\t\t.attr('class', 'legend')\n\t\t.attr('height', '50')\n\t\t.attr('width',  function() { \n\t\t\treturn colorScale.domain().length * 50 + 50;\n\t\t})\n\t\t.append('g')\n\t\t.attr('class', 'legend-container')\n\t\t.attr('transform', 'translate(10, 10)')\n\t\t\n\n\tconst legendItems = legendContainer.selectAll('.legend-item')\n\t\t.data(colorScale.domain())\n\t\t.enter()\n\t\t.append('g')\n\t\t.attr('class', 'legend-item')\n\t\t.attr('transform', (d, i) => `translate(${i * 50}, 0)`);\n\n\tlegendItems.append('rect')\n\t\t.attr('width', 15)\n\t\t.attr('height', 15)\n\t\t.attr('margin-bottom', '3px')\n\t\t.style('fill', d => colorScale(d));\n\n\tlegendItems.append('text')\n\t\t.attr('x', 20)\n\t\t.attr('y', 15)\n\t\t.style('font-size', 'medium')\n\t\t.text(d => d);\n\n}\n","import * as preprocess from \"./preprocess.js\"\r\nimport Tooltip from \"./tooltip.js\";\r\n\r\nlet sankeyData = [];\r\nlet alluvialData = [];\r\n\r\nlet graph = {\r\n  nodes: [],\r\n  links: [],\r\n};\r\n\r\nconst width = 1500;\r\nconst height = 1000;\r\n\r\nconst tooltip = new Tooltip();\r\n\r\nexport function loadData() {\r\n  d3.select(\"#viz3\").on(\"mouseover\", null)\r\n  d3.csv('./alluvial_data.csv')\r\n    .then(files => {\r\n      preprocess.setAlluvialData(files[0]);\r\n      createAlluvialViz();\r\n    })\r\n}\r\n\r\nexport function initAlluvial() {\r\n  d3.select(\"#viz3\").on(\"mouseover\", loadData)\r\n}\r\n\r\n\r\n/* Ne correspond à rien \r\nA MODIFIER\r\n*/\r\nfunction extractTimes(name) {\r\n  switch(name) {\r\n    case \"matin\":\r\n      return \"4h-10h\"\r\n    case \"après-midi\":\r\n      return \"10h-16h\"\r\n    case \"soire\":\r\n      return \"16h-22h\"\r\n    case \"nuit\":\r\n      return \"22h-4h\"\r\n    default:\r\n      return name\r\n  }\r\n}\r\n\r\n\r\nexport function createAlluvialViz() {\r\n\r\n  sankeyData = preprocess.getSankeyData();\r\n\r\n  graph.nodes = [];\r\n  graph.links = [];\r\n\r\n  d3.select(\"#alluvialChart\").remove();\r\n\r\n  const svg = d3.select(\"#viz3\")\r\n    .append(\"svg\")\r\n    .attr(\"id\", \"alluvialChart\")\r\n    .attr(\"width\", \"70%\")\r\n    .attr(\"height\", \"auto\");\r\n\r\n  const sankey = d3.sankey()\r\n    .nodeSort(null)\r\n    .nodeWidth(15)\r\n    .nodePadding(10)\r\n    .size([width, height]);\r\n\r\n  sankeyData.forEach(d => {\r\n    const sourceIndex = graph.nodes.findIndex(\r\n      (node) => node.name === d.source\r\n    );\r\n    const targetIndex = graph.nodes.findIndex(\r\n      (node) => node.name === d.target\r\n    );\r\n\r\n    const sourceNode = { name: d.source };\r\n    const targetNode = { name: d.target };\r\n\r\n    if (sourceIndex === -1) graph.nodes.push(sourceNode);\r\n    if (targetIndex === -1) graph.nodes.push(targetNode);\r\n\r\n    graph.links.push({\r\n      source: sourceIndex === -1 ? sourceNode : graph.nodes[sourceIndex],\r\n      target: targetIndex === -1 ? targetNode : graph.nodes[targetIndex],\r\n      value: d.count,\r\n      level: d.level\r\n    });\r\n  });\r\n\r\n  sankey(graph);\r\n\r\n  const node = svg.append(\"g\")\r\n    .selectAll(\".node\")\r\n    .data(graph.nodes)\r\n    .enter()\r\n    .append(\"g\")\r\n    .attr(\"class\", \"node\")\r\n    .attr(\"transform\", d => `translate(${d.x0},${d.y0})`);\r\n\r\n  const lastNode = node.filter((d, i) => i === graph.nodes.length - 1);\r\n  const lastNodeHeight = lastNode.node().getBoundingClientRect().height;\r\n\r\n  svg.attr(\"height\", height + lastNodeHeight);\r\n\r\n  node.append(\"rect\")\r\n    .attr(\"height\", d => d.y1 - d.y0)\r\n    .attr(\"width\", d => d.x1 - d.x0)\r\n    .on(\"mouseover\", (event, d) => {\r\n      showAlluvialNode(d.name);\r\n      return tooltip.showTooltipNode(event, extractTimes(d.name), d.value, d.layer)\r\n    })\r\n    .on(\"mouseout\", resetAlluvial)\r\n    .style(\"fill\", \"#a52a2a\");\r\n\r\n  node\r\n    .append(\"text\")\r\n    .attr(\"x\", d => d.x0 < width / 2 ? 25 : -10)\r\n    .attr(\"y\", d => (d.y1 - d.y0) / 2)\r\n    .attr(\"dy\", \"0.35em\")\r\n    .style(\"padding-top\", 10)\r\n    .attr(\"text-anchor\", d => d.x0 < width / 2 ? \"start\" : \"end\")\r\n    .text(d => d.name)\r\n    .style(\"font-size\", \"18px\");\r\n\r\n  const link = svg\r\n    .append(\"g\")\r\n    .attr(\"fill\", \"none\")\r\n    .attr(\"stroke-opacity\", 0.5)\r\n    .selectAll(\"g\")\r\n    .data(graph.links)\r\n    .join(\"g\")\r\n    .attr(\"stroke\", \"gray\");\r\n\r\n  link\r\n    .attr(\"id\", d => 'link-' + d.index)\r\n    .append(\"path\")\r\n    .attr(\"d\", d3.sankeyLinkHorizontal())\r\n    .attr(\"stroke-width\", d => Math.max(1, d.width))\r\n    .on(\"mouseover\", (event, d) => {\r\n      showAlluvialLink(d.source.name, d.target.name);\r\n      return tooltip.showTooltipLink(event, extractTimes(d.source.name), extractTimes(d.target.name), d.value, d.level)\r\n    })\r\n    .on(\"mouseout\", resetAlluvial)\r\n\r\n  // Get the bounding box of all the g elements\r\n  const bbox = svg.select(\"g\").node().getBBox();\r\n\r\n  // Set the viewBox attribute on the svg element\r\n  svg.attr(\"viewBox\", `${bbox.x} ${bbox.y} ${bbox.width} ${bbox.height}`);\r\n}\r\n\r\n\r\nfunction highlightLinks(alluvialToHighlight, sankeyToHighlight) {\r\n  sankeyToHighlight.forEach(sd => {\r\n    let sum = 0;\r\n    alluvialToHighlight.forEach(ad => {\r\n      if ((ad['airline'] == sd['source'] && ad['duration'] == sd['target']) ||\r\n        (ad['duration'] == sd['source'] && ad['departureTime'] == sd['target']) ||\r\n        (ad['departureTime'] == sd['source'] && ad['flightRange'] == sd['target'])) {\r\n        sum += ad['count'];\r\n      }\r\n    });\r\n    sd['count'] = sum;\r\n\r\n    graph.links.forEach(link => {\r\n      const linkToModify = d3.select(\"#link-\" + link.index);\r\n      const linkPath = linkToModify.select(\"path\");\r\n      if (link['source'].name == sd['source'] && link['target'].name == sd['target']) {\r\n        const colorPercentage = sd['count'] / link['value'];\r\n        linkPath.attr(\"stroke-opacity\", 0.5)\r\n          .attr(\"stroke\", \"red\")\r\n          .attr(\"stroke-width\", d => Math.max(1, d.width * colorPercentage));\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nfunction showAlluvialLink(sourceName, targetName) {\r\n  alluvialData = preprocess.getFilteredAlluvialData();\r\n  let alluvialToHighlight = [];\r\n  let sankeyToHighlight = [];\r\n\r\n  // Filter the alluvialData to include only the relevant connections\r\n  alluvialData.forEach(d => {\r\n    const nameArray = [d['airline'], d['duration'], d['departureTime'], d['flightRange']]\r\n    if ( nameArray.includes(sourceName) && nameArray.includes(targetName)) {\r\n      alluvialToHighlight.push(d);\r\n    }\r\n  });\r\n\r\n  // Filter the sankeyData to include only the relevant connections\r\n  alluvialToHighlight.forEach(ad => {\r\n    const nameArray = [ad['airline'], ad['duration'], ad['departureTime'], ad['flightRange']]\r\n    sankeyData.forEach(sd => {\r\n      if (nameArray.includes(sd['source']) && nameArray.includes(sd['target'])) {\r\n        if (!sankeyToHighlight.includes(sd)) {\r\n          sankeyToHighlight.push(sd);\r\n        }\r\n      }\r\n    });\r\n  });\r\n\r\n  highlightLinks(alluvialToHighlight, sankeyToHighlight);\r\n}\r\n\r\nfunction showAlluvialNode(nodeName) {\r\n  alluvialData = preprocess.getFilteredAlluvialData();\r\n  let alluvialToHighlight = [];\r\n  let sankeyToHighlight = [];\r\n\r\n  // Filter the alluvialData to include only the relevant connections\r\n  alluvialData.forEach(d => {\r\n    const nameArray = [d['airline'], d['duration'], d['departureTime'], d['flightRange']]\r\n    if (nameArray.includes(nodeName)) {\r\n      alluvialToHighlight.push(d);\r\n    }\r\n  });\r\n\r\n  // Filter the sankeyData to include only the relevant connections\r\n  alluvialToHighlight.forEach(ad => {\r\n    sankeyData.forEach(sd => {\r\n      if ((sd['source'] == ad['airline'] && sd['target'] == ad['duration']) || (sd['source'] == ad['duration'] && sd['target'] == ad['departureTime']) ||\r\n        (sd['source'] == ad['departureTime'] && sd['target'] == ad['flightRange'])) {\r\n        if (!sankeyToHighlight.includes(sd)) {\r\n          sankeyToHighlight.push(sd);\r\n        }\r\n      }\r\n    });\r\n  });\r\n\r\n  highlightLinks(alluvialToHighlight, sankeyToHighlight);\r\n}\r\n\r\nfunction resetAlluvial() {\r\n  graph.links.forEach(link => {\r\n    const linkToModify = d3.select(\"#link-\" + link.index);\r\n    const linkPath = linkToModify.select(\"path\");\r\n    linkPath.attr(\"stroke\", \"gray\")\r\n      .attr(\"stroke-opacity\", 0.5)\r\n      .attr(\"stroke-width\", d => Math.max(1, d.width));\r\n  });\r\n}","import * as preprocess from './preprocess.js'\nimport * as alluvial from './alluvial.js'\nimport * as waffle from './viz4.js'\n\nimport Tooltip from './tooltip.js'\n\nconst BUCKET_HEIGHT = 300;\nconst BUCKET_WIDTH = 200;\n\nlet tooltip = new Tooltip();\n\n\nexport function displayBucketGraph() {\n  const companiesFlightArray = preprocess.getCompaniesFlightArray();\n  const heightScale = createHeightScale(companiesFlightArray);\n  const bottomBucket = [...companiesFlightArray];\n  const topBucket = preprocess.resizeTopCompagnies(bottomBucket);\n  setUpSlider()\n  displayTopBucket(topBucket, heightScale);\n  displayBottomBucket(bottomBucket, heightScale);\n}\n\nexport function setUpSlider() {\n  var\tslider=document.getElementById(\"slider\")\n\tvar sliderValue=document.getElementById(\"slider-value\")\n\tsliderValue.innerHTML=slider.value\n  preprocess.filterAlluvialData()\n\tslider.oninput=function() {\n\t\tsliderValue.innerHTML=this.value\n    d3.select('#topSVG').selectAll('*').remove()\n    d3.select('#bottomSVG').selectAll('*').remove()\n    preprocess.setTopCompaniesCount(this.value)\n    displayBucketGraph()\n    preprocess.filterAlluvialData()\n    if(preprocess.getCompaniesAircraftsMap().length != 0)\n      waffle.modifyData();\n    \n\t}\n  alluvial.createAlluvialViz();\n}\n\nfunction displayTopBucket(topBucket, heightScale) {\n  d3.select(\"#topSVG\")\n    .selectAll('.topCompany')\n    .data(topBucket)\n    .enter()\n    .append('g')\n    .attr('class', 'topCompany')\n    .append('rect')\n    .attr('class', 'bucket-tile')\n    .attr('y', function(c, index) {\n      let y = BUCKET_HEIGHT;\n      for(let i =0; i <= index; i++){\n        y -= heightScale(topBucket[i][1])\n      }\n      return y;\n    })\n    .attr('fill', 'rgb(75, 115, 47)')\n    .attr('height', function(c) { \n      return heightScale(c[1])})\n    .attr('width', BUCKET_WIDTH)\n    .attr('stroke', 'rgb(40, 63, 25)')\n    .attr('stroke-width', '2px')\n    .on(\"mouseover\", function(m, d) {\n      d3.select(this)\n        .attr('fill', 'rgb(124, 191, 78)')\n      return tooltip.showTooltipTop(m, d) }\n    )\n    .on(\"mousemove\", function(m) { return tooltip.moveTooltip(m) })\n    .on(\"mouseleave\", function() {\n      d3.select(this)\n        .attr('fill', 'rgb(75, 115, 47)')\n\n      return tooltip.hideTooltip()\n    } )\n  d3.selectAll('.topCompany')\n    .append('text')\n    .attr('y', function(c, index) {\n      let y = BUCKET_HEIGHT;\n      for(let i =0; i <= index; i++){\n        y -= heightScale(topBucket[i][1])\n      }\n      y +=heightScale(c[1])/2\n      return y;\n    })\n    .attr('x', function() {return BUCKET_WIDTH / 2})\n    .attr('font-size', '18px')\n    .attr('text-anchor', 'middle')\n    .attr('fill', 'white')\n    .style('pointer-events', 'none')\n    .style('user-select', 'none')\n    .text(function(c) {\n      const height = heightScale(c[1]);\n      if(height > 22){\n        return c[0];\n      }\n      else if (height > 7) {\n        return \"...\"\n      }\n      return \"\"\n    })\n}\n\nfunction displayBottomBucket(bottomBucket, heightScale) {\n  const height = heightScale(d3.sum(bottomBucket, function(c) {return c[1]}))\n  let toolTipDisplay = \"\"\n  let flightTotal = 0;\n  for(let i = 0; i < 5; i++){\n    toolTipDisplay += (i+1) + '.' + ' ' + bottomBucket[i][0] + ': ' + bottomBucket[i][1] + ' vols <br>'\n    flightTotal += bottomBucket[i][1];\n  }\n  toolTipDisplay += '<br><b>Nombre total de vols: ' + flightTotal + ' vols</b>'\n  d3.select(\"#bottomSVG\")\n    .append('g')\n    .attr('width', BUCKET_WIDTH)\n    .style('text-align', 'center')\n    .attr('class', 'bottomCompany')\n    .append('rect')\n    .attr('class', 'bucket-tile')\n    .attr('y', function(c, index) {\n      return BUCKET_HEIGHT - height;\n    })\n    .attr('fill', \"rgb(59, 56, 56)\")\n    .attr('height', function(c) { \n      return height})\n    .attr('width', BUCKET_WIDTH)\n    .attr('stroke-width', '2px')\n    .attr('stroke', 'rgb(44, 42, 42)')\n    .on(\"mouseover\", function(m) { \n      d3.select(this).style('fill', 'rgb(96, 91, 91)')\n      return tooltip.showTooltipBottom(m, toolTipDisplay) })\n    .on(\"mousemove\", function(m) { return tooltip.moveTooltip(m) })\n    .on(\"mouseleave\", function() {\n      d3.select(this).style('fill', 'rgb(59, 56, 56)')\n      return tooltip.hideTooltip()\n    } )\n  d3.select('.bottomCompany').append('text').attr('y', function() {\n      return BUCKET_HEIGHT - height/2;\n    })\n    .attr('x', function() {return BUCKET_WIDTH / 2})\n    .attr('font-size', '18px')\n    .attr('text-anchor', 'middle')\n    .attr('fill', 'white')\n    .style('pointer-events', 'none')\n    .style('user-select', 'none')\n    .text('Autres compagnies')\n}\n\nfunction createHeightScale (topCompanies) {\n  const maxHeight = d3.sum(topCompanies, c => c[1])\n  return d3.scaleLinear().domain([d3.min(topCompanies, function(d) {return d[1]}), maxHeight]).range([0, BUCKET_HEIGHT])\n}","(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n  typeof define === 'function' && define.amd ? define(factory) :\n  (global = global || self, global.scrollama = factory());\n}(this, (function () { 'use strict';\n\n  // DOM helper functions\n\n  // public\n  function selectAll(selector, parent = document) {\n    if (typeof selector === 'string') {\n      return Array.from(parent.querySelectorAll(selector));\n    } else if (selector instanceof Element) {\n      return [selector];\n    } else if (selector instanceof NodeList) {\n      return Array.from(selector);\n    } else if (selector instanceof Array) {\n      return selector;\n    }\n    return [];\n  }\n\n  // SETUP\n  function create(className) {\n  \tconst el = document.createElement(\"div\");\n  \tel.className = `scrollama__debug-step ${className}`;\n  \tel.style.position = \"fixed\";\n  \tel.style.left = \"0\";\n  \tel.style.width = \"100%\";\n  \tel.style.zIndex = \"9999\";\n  \tel.style.borderTop = \"2px solid black\";\n  \tel.style.borderBottom = \"2px solid black\";\n\n  \tconst p = document.createElement(\"p\");\n  \tp.style.position = \"absolute\";\n  \tp.style.left = \"0\";\n  \tp.style.height = \"1px\";\n  \tp.style.width = \"100%\";\n  \tp.style.borderTop = \"1px dashed black\";\n\n  \tel.appendChild(p);\n  \tdocument.body.appendChild(el);\n  \treturn el;\n  }\n\n  // UPDATE\n  function update({ id, step, marginTop }) {\n  \tconst { index, height } = step;\n  \tconst className = `scrollama__debug-step--${id}-${index}`;\n  \tlet el = document.querySelector(`.${className}`);\n  \tif (!el) el = create(className);\n\n  \tel.style.top = `${marginTop * -1}px`;\n  \tel.style.height = `${height}px`;\n  \tel.querySelector(\"p\").style.top = `${height / 2}px`;\n  }\n\n  function generateId() {\n      const alphabet = \"abcdefghijklmnopqrstuvwxyz\";\n      const date = Date.now();\n      const result = [];\n      for (let i = 0; i < 6; i += 1) {\n        const char = alphabet[Math.floor(Math.random() * alphabet.length)];\n        result.push(char);\n      }\n      return `${result.join(\"\")}${date}`;\n    }\n\n  function err$1(msg) {\n  \tconsole.error(`scrollama error: ${msg}`);\n  }\n\n  function getIndex(node) {\n  \treturn +node.getAttribute(\"data-scrollama-index\");\n  }\n\n  function createProgressThreshold(height, threshold) {\n      const count = Math.ceil(height / threshold);\n      const t = [];\n      const ratio = 1 / count;\n      for (let i = 0; i < count + 1; i += 1) {\n        t.push(i * ratio);\n      }\n      return t;\n    }\n\n  function parseOffset(x) {\n  \tif (typeof x === \"string\" && x.indexOf(\"px\") > 0) {\n  \t\tconst v = +x.replace(\"px\", \"\");\n  \t\tif (!isNaN(v)) return { format: \"pixels\", value: v };\n  \t\telse {\n  \t\t\terr(\"offset value must be in 'px' format. Fallback to 0.5.\");\n  \t\t\treturn { format: \"percent\", value: 0.5 };\n  \t\t}\n  \t} else if (typeof x === \"number\" || !isNaN(+x)) {\n  \t\tif (x > 1) err(\"offset value is greater than 1. Fallback to 1.\");\n  \t\tif (x < 0) err(\"offset value is lower than 0. Fallback to 0.\");\n  \t\treturn { format: \"percent\", value: Math.min(Math.max(0, x), 1) };\n  \t}\n  \treturn null;\n  }\n\n  function indexSteps(steps) {\n  \tsteps.forEach((step) =>\n  \t\tstep.node.setAttribute(\"data-scrollama-index\", step.index)\n  \t);\n  }\n\n  function getOffsetTop(node) {\n    const { top } = node.getBoundingClientRect();\n    const scrollTop = window.pageYOffset;\n    const clientTop = document.body.clientTop || 0;\n    return top + scrollTop - clientTop;\n  }\n\n  let currentScrollY;\n  let comparisonScrollY;\n  let direction;\n\n  function onScroll(container) {\n  \tconst scrollTop = container ? container.scrollTop : window.pageYOffset;\n\n  \tif (currentScrollY === scrollTop) return;\n  \tcurrentScrollY = scrollTop;\n  \tif (currentScrollY > comparisonScrollY) direction = \"down\";\n  \telse if (currentScrollY < comparisonScrollY) direction = \"up\";\n  \tcomparisonScrollY = currentScrollY;\n  }\n\n  function setupScroll(container) {\n  \tcurrentScrollY = 0;\n  \tcomparisonScrollY = 0;\n  \tdocument.addEventListener(\"scroll\", () => onScroll(container));\n  }\n\n  function scrollama() {\n  \tlet cb = {};\n\n  \tlet id = generateId();\n  \tlet steps = [];\n  \tlet globalOffset;\n  \tlet containerElement;\n  \tlet rootElement;\n\n  \tlet progressThreshold = 0;\n\n  \tlet isEnabled = false;\n  \tlet isProgress = false;\n  \tlet isDebug = false;\n  \tlet isTriggerOnce = false;\n\n  \tlet exclude = [];\n\n  \t/* HELPERS */\n  \tfunction reset() {\n  \t\tcb = {\n  \t\t\tstepEnter: () => { },\n  \t\t\tstepExit: () => { },\n  \t\t\tstepProgress: () => { },\n  \t\t};\n  \t\texclude = [];\n  \t}\n\n  \tfunction handleEnable(shouldEnable) {\n  \t\tif (shouldEnable && !isEnabled) updateObservers();\n  \t\tif (!shouldEnable && isEnabled) disconnectObservers();\n  \t\tisEnabled = shouldEnable;\n  \t}\n\n  \t/* NOTIFY CALLBACKS */\n  \tfunction notifyProgress(element, progress) {\n  \t\tconst index = getIndex(element);\n  \t\tconst step = steps[index];\n  \t\tif (progress !== undefined) step.progress = progress;\n  \t\tconst response = { element, index, progress, direction };\n  \t\tif (step.state === \"enter\") cb.stepProgress(response);\n  \t}\n\n  \tfunction notifyStepEnter(element, check = true) {\n  \t\tconst index = getIndex(element);\n  \t\tconst step = steps[index];\n  \t\tconst response = { element, index, direction };\n\n  \t\tstep.direction = direction;\n  \t\tstep.state = \"enter\";\n\n  \t\t// if (isPreserveOrder && check && direction !== \"up\")\n  \t\t//   notifyOthers(index, \"above\");\n  \t\t// if (isPreserveOrder && check && direction === \"up\")\n  \t\t//   notifyOthers(index, \"below\");\n\n  \t\tif (!exclude[index]) cb.stepEnter(response);\n  \t\tif (isTriggerOnce) exclude[index] = true;\n  \t}\n\n  \tfunction notifyStepExit(element, check = true) {\n  \t\tconst index = getIndex(element);\n  \t\tconst step = steps[index];\n\n  \t\tif (!step.state) return false;\n\n  \t\tconst response = { element, index, direction };\n\n  \t\tif (isProgress) {\n  \t\t\tif (direction === \"down\" && step.progress < 1) notifyProgress(element, 1);\n  \t\t\telse if (direction === \"up\" && step.progress > 0)\n  \t\t\t\tnotifyProgress(element, 0);\n  \t\t}\n\n  \t\tstep.direction = direction;\n  \t\tstep.state = \"exit\";\n\n  \t\tcb.stepExit(response);\n  \t}\n\n  \t/* OBSERVERS - HANDLING */\n  \tfunction resizeStep([entry]) {\n  \t\tconst index = getIndex(entry.target);\n  \t\tconst step = steps[index];\n  \t\tconst h = entry.target.offsetHeight;\n  \t\tif (h !== step.height) {\n  \t\t\tstep.height = h;\n  \t\t\tdisconnectObserver(step);\n  \t\t\tupdateStepObserver(step);\n  \t\t\tupdateResizeObserver(step);\n  \t\t}\n  \t}\n\n  \tfunction intersectStep([entry]) {\n  \t\tonScroll(containerElement);\n\n  \t\tconst { isIntersecting, target } = entry;\n  \t\tif (isIntersecting) notifyStepEnter(target);\n  \t\telse notifyStepExit(target);\n  \t}\n\n  \tfunction intersectProgress([entry]) {\n  \t\tconst index = getIndex(entry.target);\n  \t\tconst step = steps[index];\n  \t\tconst { isIntersecting, intersectionRatio, target } = entry;\n  \t\tif (isIntersecting && step.state === \"enter\")\n  \t\t\tnotifyProgress(target, intersectionRatio);\n  \t}\n\n  \t/*  OBSERVERS - CREATION */\n  \tfunction disconnectObserver({ observers }) {\n  \t\tObject.keys(observers).map((name) => {\n  \t\t\tobservers[name].disconnect();\n  \t\t});\n  \t}\n\n  \tfunction disconnectObservers() {\n  \t\tsteps.forEach(disconnectObserver);\n  \t}\n\n  \tfunction updateResizeObserver(step) {\n  \t\tconst observer = new ResizeObserver(resizeStep);\n  \t\tobserver.observe(step.node);\n  \t\tstep.observers.resize = observer;\n  \t}\n\n  \tfunction updateResizeObservers() {\n  \t\tsteps.forEach(updateResizeObserver);\n  \t}\n\n  \tfunction updateStepObserver(step) {\n  \t\tconst h = window.innerHeight;\n  \t\tconst off = step.offset || globalOffset;\n  \t\tconst factor = off.format === \"pixels\" ? 1 : h;\n  \t\tconst offset = off.value * factor;\n  \t\tconst marginTop = step.height / 2 - offset;\n  \t\tconst marginBottom = step.height / 2 - (h - offset);\n  \t\tconst rootMargin = `${marginTop}px 0px ${marginBottom}px 0px`;\n  \t\tconst root = rootElement;\n\n  \t\tconst threshold = 0.5;\n  \t\tconst options = { rootMargin, threshold, root };\n  \t\tconst observer = new IntersectionObserver(intersectStep, options);\n\n  \t\tobserver.observe(step.node);\n  \t\tstep.observers.step = observer;\n\n  \t\tif (isDebug) update({ id, step, marginTop, marginBottom });\n  \t}\n\n  \tfunction updateStepObservers() {\n  \t\tsteps.forEach(updateStepObserver);\n  \t}\n\n  \tfunction updateProgressObserver(step) {\n  \t\tconst h = window.innerHeight;\n  \t\tconst off = step.offset || globalOffset;\n  \t\tconst factor = off.format === \"pixels\" ? 1 : h;\n  \t\tconst offset = off.value * factor;\n  \t\tconst marginTop = -offset + step.height;\n  \t\tconst marginBottom = offset - h;\n  \t\tconst rootMargin = `${marginTop}px 0px ${marginBottom}px 0px`;\n\n  \t\tconst threshold = createProgressThreshold(step.height, progressThreshold);\n  \t\tconst options = { rootMargin, threshold };\n  \t\tconst observer = new IntersectionObserver(intersectProgress, options);\n\n  \t\tobserver.observe(step.node);\n  \t\tstep.observers.progress = observer;\n  \t}\n\n  \tfunction updateProgressObservers() {\n  \t\tsteps.forEach(updateProgressObserver);\n  \t}\n\n  \tfunction updateObservers() {\n  \t\tdisconnectObservers();\n  \t\tupdateResizeObservers();\n  \t\tupdateStepObservers();\n  \t\tif (isProgress) updateProgressObservers();\n  \t}\n\n  \t/* SETUP */\n  \tconst S = {};\n\n  \tS.setup = ({\n  \t\tstep,\n  \t\tparent,\n  \t\toffset = 0.5,\n  \t\tthreshold = 4,\n  \t\tprogress = false,\n  \t\tonce = false,\n  \t\tdebug = false,\n  \t\tcontainer = undefined,\n  \t\troot = null\n  \t}) => {\n\n  \t\tsetupScroll(container);\n\n  \t\tsteps = selectAll(step, parent).map((node, index) => ({\n  \t\t\tindex,\n  \t\t\tdirection: undefined,\n  \t\t\theight: node.offsetHeight,\n  \t\t\tnode,\n  \t\t\tobservers: {},\n  \t\t\toffset: parseOffset(node.dataset.offset),\n  \t\t\ttop: getOffsetTop(node),\n  \t\t\tprogress: 0,\n  \t\t\tstate: undefined,\n  \t\t}));\n\n  \t\tif (!steps.length) {\n  \t\t\terr$1(\"no step elements\");\n  \t\t\treturn S;\n  \t\t}\n\n  \t\tisProgress = progress;\n  \t\tisTriggerOnce = once;\n  \t\tisDebug = debug;\n  \t\tprogressThreshold = Math.max(1, +threshold);\n  \t\tglobalOffset = parseOffset(offset);\n  \t\tcontainerElement = container;\n  \t\trootElement = root;\n\n  \t\treset();\n  \t\tindexSteps(steps);\n  \t\thandleEnable(true);\n  \t\treturn S;\n  \t};\n\n  \tS.enable = () => {\n  \t\thandleEnable(true);\n  \t\treturn S;\n  \t};\n\n  \tS.disable = () => {\n  \t\thandleEnable(false);\n  \t\treturn S;\n  \t};\n\n  \tS.destroy = () => {\n  \t\thandleEnable(false);\n  \t\treset();\n  \t\treturn S;\n  \t};\n\n  \tS.resize = () => {\n  \t\tupdateObservers();\n  \t\treturn S;\n  \t};\n\n  \tS.offset = (x) => {\n  \t\tif (x === null || x === undefined) return globalOffset.value;\n  \t\tglobalOffset = parseOffset(x);\n  \t\tupdateObservers();\n  \t\treturn S;\n  \t};\n\n  \tS.onStepEnter = (f) => {\n  \t\tif (typeof f === \"function\") cb.stepEnter = f;\n  \t\telse err$1(\"onStepEnter requires a function\");\n  \t\treturn S;\n  \t};\n\n  \tS.onStepExit = (f) => {\n  \t\tif (typeof f === \"function\") cb.stepExit = f;\n  \t\telse err$1(\"onStepExit requires a function\");\n  \t\treturn S;\n  \t};\n\n  \tS.onStepProgress = (f) => {\n  \t\tif (typeof f === \"function\") cb.stepProgress = f;\n  \t\telse err$1(\"onStepProgress requires a function\");\n  \t\treturn S;\n  \t};\n  \treturn S;\n  }\n\n  return scrollama;\n\n})));\n","import Tooltip from '../tooltip';\nimport { groupByMainCompanies } from '../preprocess.js';\n\nexport default class Network {\n\n  constructor(svg, ratio = 1) {\n    this.tooltip = new Tooltip()\n    this.ratio = ratio\n    this.svg = svg;\n    this.airportCode = {};\n    this.levelGeo = { 1: \"QC\", 2: \"CA\", 3: \"WORLD\", 4: null, \"QC\": 1, \"CA\": 2, \"WORLD\": 3, null: 4 };\n    this.ccolor = {\n      \"Africa\": 'rgba(0, 0, 255,',\n      \"America\": 'rgba(151, 18, 18,',\n      \"Europe\": 'rgba(0, 255, 0,',\n      \"Asia\": 'rgba(0, 255, 255,',\n      \"Oceania\": 'rgba(255, 0, 255,'\n    }\n    this.currentGeo = \"QC\";\n    this.limits = [];\n    this.minMaxXGlobal = [1000000, 0];\n    this.minMaxYGlobal = [1000000, 0];\n  }\n\n  scaleSize(data) {\n    return 2 * (parseFloat(data) / 10E4 + Math.log(data) / 5);\n  }\n\n  displayAirports() {\n\n    var readAirports = function (localairports) {\n\n      var nb = localairports.length\n      var minMaxX = d3.extent(localairports, d => parseFloat(d.lat))\n      var minMaxY = d3.extent(localairports, d => parseFloat(d.lon) / this.ratio)\n\n      localairports.forEach(item => this.airportCode[item.airport] = [ parseFloat(item.lat),  parseFloat(item.lon) / this.ratio])\n      \n      minMaxX = [Math.min(minMaxX[0] - 10, this.minMaxXGlobal[0]), Math.max(minMaxX[1] + 10, this.minMaxXGlobal[1])]\n      minMaxY = [Math.min(minMaxY[0] - 10, this.minMaxYGlobal[0]), Math.max(minMaxY[1] + 10, this.minMaxYGlobal[1])]\n\n      if (this.limits[this.levelGeo[this.currentGeo]] === undefined) {\n        this.limits[this.levelGeo[this.currentGeo]] = `${minMaxX[0]},${minMaxY[0]},${minMaxX[1] - minMaxX[0]},${minMaxY[1] - minMaxY[0]}`\n      }\n\n      this.minMaxXGlobal, this.minMaxYGlobal = minMaxX, minMaxY\n\n      var self = this\n\n      this.svg.transition()\n        .ease(d3.easePolyInOut)\n        .duration(800)\n        .attr(\"viewBox\", this.limits[this.levelGeo[this.currentGeo]])\n        .attr(\"transform-box\", \"content-box\")\n\n      var circles = this.svg.selectAll('airports')\n        .data(localairports)\n        .join('circle')\n\n      if (this.currentGeo !== \"WORLD\") {\n        circles.on(\"mouseover\", function (m, data) {\n          d3.select(this)\n            .attr(\"r\", d => 1.5 * self.scaleSize(d.freq))\n            .attr('stroke-width', '.4')\n          return self.tooltip.showTooltipAirport(m, [data.airport, data.country, data.city, data.freq])\n        })\n          .on(\"mouseleave\", function (e) {\n            d3.select(this)\n              .attr(\"r\", d => self.scaleSize(d.freq))\n              .attr('stroke-width', '.1')\n            return self.tooltip.hideTooltip()\n          })\n      }\n\n      circles.attr('stroke', 'black')\n        .attr('stroke-width', '.1')\n        .attr('class', d => this.currentGeo + \" \" + d.continent + \" \" + d.airport)\n        .attr(\"transform\", d => `translate(${this.airportCode[d.airport]})`)\n        .attr(\"r\", 0)\n        .transition()\n        .ease(d3.easeCubicOut)\n        .delay(function (d, i) { return 100 * i / nb; })\n        .duration(800)\n        .attr(\"r\", d => this.scaleSize(d.freq))\n        .style('fill', d => (this.currentGeo == \"QC\") ? 'rgba(255, 0, 0, 0.6)' : (this.ccolor[d.continent] + ' 0.6)'))\n\n      if (this.currentGeo === \"WORLD\") {\n\n        var circlesTooltips = this.svg.selectAll('airports')\n          .data(localairports)\n          .join('circle')\n\n        circlesTooltips.attr(\"r\", d => Math.max(8, self.scaleSize(d.freq)))\n          .attr(\"transform\", d => `translate(${this.airportCode[d.airport]})`)\n          .attr(\"opacity\", 0)\n          .attr(\"class\", d => this.currentGeo + \" \" + d.continent + \" \" + d.airport + \" tooltipsCircle\")\n          .on(\"mouseover\", function (m, data) {\n            d3.select(\".\" + data.airport)\n              .attr(\"r\", 1.5 * self.scaleSize(data.freq))\n              .attr('stroke-width', '.4')\n            return self.tooltip.showTooltipAirport(m, [data.airport, data.country, data.city, data.freq])\n          })\n          .on(\"mouseleave\", function (m, data) {\n            d3.select(\".\" + data.airport).attr(\"r\", d => Math.log(d.freq + 1) / 4)\n              .attr('stroke-width', '.1')\n            return self.tooltip.hideTooltip()\n          })\n      }\n\n      this.currentGeo = this.levelGeo[this.levelGeo[this.currentGeo] + 1];\n    }\n\n    d3.csv(`./${this.currentGeo}/airports${this.currentGeo}.csv`)\n      .then(readAirports.bind(this))\n  }\n\n  displayFlights() {\n\n    var readFlights = function (localflights) {\n      this.svg.selectAll('flights')\n        .data(localflights)\n        .join('line')\n        .attr('class', this.currentGeo)\n        .attr('x1', d => this.airportCode[d.airportIn][0])\n        .attr('y1', d => this.airportCode[d.airportIn][1])\n        .attr('x2', d => this.airportCode[d.airportIn][0])\n        .attr('y2', d => this.airportCode[d.airportIn][1])\n        .style('stroke-width', d => 2 * this.scaleSize(d.number))\n        .transition()\n        .ease(d3.easeCubicInOut)\n        .duration(800)\n        .attr('x2', d => this.airportCode[d.airportOut][0])\n        .attr('y2', d => this.airportCode[d.airportOut][1])\n        .style('stroke', d => (d.company === \"OTHERS\") ? 'rgba(255, 0, 0, 0.02)' : 'rgba(0, 0, 0, 0.2)')\n\n      this.currentGeo = this.levelGeo[this.levelGeo[this.currentGeo] + 1];\n      this.svg.selectAll('circle').raise()\n    }\n\n    this.currentGeo = this.levelGeo[this.levelGeo[this.currentGeo] - 1];\n    d3.csv(`./${this.currentGeo}/flights${this.currentGeo}.csv`)\n      .then(groupByMainCompanies)\n      .then(readFlights.bind(this))\n  }\n\n  removeAirports(db = true) {\n    this.currentGeo = this.levelGeo[this.levelGeo[this.currentGeo] - 1];\n\n    if (db) {\n      this.svg.transition()\n        .duration(1000)\n        .attr(\"viewBox\", this.limits[this.levelGeo[this.currentGeo] - 1])\n\n      this.svg.selectAll('circle.' + this.currentGeo)\n        .transition()\n        .duration(1000)\n        .attr(\"r\", 0)\n        .remove()\n\n    } else {\n      this.currentGeo = \"QC\";\n\n      [\"WORLD\", \"CA\", \"QC\"].forEach(lvl => {\n        this.svg.selectAll('line.' + lvl)\n          .transition()\n          .duration(1000)\n          .style('stroke', 'rgba(0, 0, 0, 0.0)')\n          .remove()\n\n        this.svg.selectAll('circle.' + lvl)\n          .transition()\n          .duration(1000)\n          .attr(\"r\", 0)\n          .remove()\n      });\n    }\n  }\n\n  removeFlights() {\n    this.svg.selectAll('line.' + this.levelGeo[this.levelGeo[this.currentGeo] - 1])\n      .transition()\n      .duration(1000)\n      .style('stroke', 'rgba(0, 0, 0, 0.0)')\n      .remove()\n  }\n}","import scrollama from \"scrollama\";\nimport Network from \"./scrolly/network.js\";\n\n// using d3 for convenience\nvar main = d3.select(\"main\");\nvar scrolly = main.select(\"#scrolly\");\nvar figure = scrolly.select(\"figure\");\nvar article = scrolly.select(\"article\");\nvar step = article.selectAll(\".step\");\n\nvar figureHeight = 4 * window.innerHeight / 5;\n\n// initialize the scrollama\nvar scroller = scrollama();\n\nconst svg = d3.select('#viz2')\n    .append('svg')\n\nfunction handleResize() {\n    const stepH = Math.floor(window.innerHeight * 0.75);\n    step.style(\"height\", stepH + \"px\");\n    const figureMarginTop = (window.innerHeight - figureHeight) / 2;\n\n    figure.style(\"height\", figureHeight + \"px\")\n        .style(\"top\", figureMarginTop + \"px\");\n\n    scroller.resize();\n}\n\n\nconst figWidth = d3.select(\"figure\")\n    .node()\n    .getBoundingClientRect()\n    .width\n\nconst network = new Network(svg, figWidth / figureHeight);\n\nfunction handleStepEnter(response) {\n    if (response.direction === 'down') {\n        if (response.index % 2 === 0 && response.index !== 6) {\n            network.displayAirports()\n        } else if (response.index % 2 === 1) {\n            network.displayFlights()\n        }\n    } else {\n        if ((response.index % 2 === 1) && response.index !== 5) {\n            network.removeAirports()\n        } else if ((response.index % 2 === 0) && response.index !== 6) {\n            network.removeFlights()\n        }\n    }\n}\n\nfunction handleStepExit(response) {\n    if (response.direction === 'up' && response.index === 0) {\n        network.removeAirports(false);\n    }\n}\n\nexport function initNetwork() {\n\n    handleResize();\n    scroller\n        .setup({\n            step: \"#scrolly article .step\",\n            offset: 0.33,\n            debug: false\n        })\n        .onStepExit(handleStepExit)\n        .onStepEnter(handleStepEnter);\n}","import * as waffles from './scripts/viz4.js'\nimport * as alluvial from './scripts/alluvial.js'\nimport * as buckets from './scripts/viz1.js'\nimport * as preprocess from './scripts/preprocess.js'\nimport * as network from './scripts/scrolly.js'\n\nwindow.onbeforeunload = function () {\n    window.scrollTo(0, 0);\n  }\n\nwindow.onload = () => {\n\n    Promise.all([\n        d3.csv('./WORLD/flightsWORLD.csv'),\n        d3.csv('./CA/flightsCA.csv'),\n        d3.csv('./QC/flightsQC.csv'),\n        d3.csv('./alluvial_data.csv')\n    ]).then(function (files) {\n        preprocess.setData(files[0].concat(files[1], files[2]));\n        preprocess.setAlluvialData(files[3]);\n        preprocess.setTopCompaniesCount(5);\n        buckets.displayBucketGraph();\n        buckets.setUpSlider();\n    })\n\n    network.initNetwork()\n    // alluvial.initAlluvial()\n    waffles.initWaffle()\n};\n\n\n\n\n","var OVERLAY_ID = '__parcel__error__overlay__';\n\nvar OldModule = module.bundle.Module;\n\nfunction Module(moduleName) {\n  OldModule.call(this, moduleName);\n  this.hot = {\n    data: module.bundle.hotData,\n    _acceptCallbacks: [],\n    _disposeCallbacks: [],\n    accept: function (fn) {\n      this._acceptCallbacks.push(fn || function () {});\n    },\n    dispose: function (fn) {\n      this._disposeCallbacks.push(fn);\n    }\n  };\n\n  module.bundle.hotData = null;\n}\n\nmodule.bundle.Module = Module;\nvar checkedAssets, assetsToAccept;\n\nvar parent = module.bundle.parent;\nif ((!parent || !parent.isParcelRequire) && typeof WebSocket !== 'undefined') {\n  var hostname = process.env.HMR_HOSTNAME || location.hostname;\n  var protocol = location.protocol === 'https:' ? 'wss' : 'ws';\n  var ws = new WebSocket(protocol + '://' + hostname + ':' + process.env.HMR_PORT + '/');\n  ws.onmessage = function(event) {\n    checkedAssets = {};\n    assetsToAccept = [];\n\n    var data = JSON.parse(event.data);\n\n    if (data.type === 'update') {\n      var handled = false;\n      data.assets.forEach(function(asset) {\n        if (!asset.isNew) {\n          var didAccept = hmrAcceptCheck(global.parcelRequire, asset.id);\n          if (didAccept) {\n            handled = true;\n          }\n        }\n      });\n\n      // Enable HMR for CSS by default.\n      handled = handled || data.assets.every(function(asset) {\n        return asset.type === 'css' && asset.generated.js;\n      });\n\n      if (handled) {\n        console.clear();\n\n        data.assets.forEach(function (asset) {\n          hmrApply(global.parcelRequire, asset);\n        });\n\n        assetsToAccept.forEach(function (v) {\n          hmrAcceptRun(v[0], v[1]);\n        });\n      } else if (location.reload) { // `location` global exists in a web worker context but lacks `.reload()` function.\n        location.reload();\n      }\n    }\n\n    if (data.type === 'reload') {\n      ws.close();\n      ws.onclose = function () {\n        location.reload();\n      }\n    }\n\n    if (data.type === 'error-resolved') {\n      console.log('[parcel] ✨ Error resolved');\n\n      removeErrorOverlay();\n    }\n\n    if (data.type === 'error') {\n      console.error('[parcel] 🚨  ' + data.error.message + '\\n' + data.error.stack);\n\n      removeErrorOverlay();\n\n      var overlay = createErrorOverlay(data);\n      document.body.appendChild(overlay);\n    }\n  };\n}\n\nfunction removeErrorOverlay() {\n  var overlay = document.getElementById(OVERLAY_ID);\n  if (overlay) {\n    overlay.remove();\n  }\n}\n\nfunction createErrorOverlay(data) {\n  var overlay = document.createElement('div');\n  overlay.id = OVERLAY_ID;\n\n  // html encode message and stack trace\n  var message = document.createElement('div');\n  var stackTrace = document.createElement('pre');\n  message.innerText = data.error.message;\n  stackTrace.innerText = data.error.stack;\n\n  overlay.innerHTML = (\n    '<div style=\"background: black; font-size: 16px; color: white; position: fixed; height: 100%; width: 100%; top: 0px; left: 0px; padding: 30px; opacity: 0.85; font-family: Menlo, Consolas, monospace; z-index: 9999;\">' +\n      '<span style=\"background: red; padding: 2px 4px; border-radius: 2px;\">ERROR</span>' +\n      '<span style=\"top: 2px; margin-left: 5px; position: relative;\">🚨</span>' +\n      '<div style=\"font-size: 18px; font-weight: bold; margin-top: 20px;\">' + message.innerHTML + '</div>' +\n      '<pre>' + stackTrace.innerHTML + '</pre>' +\n    '</div>'\n  );\n\n  return overlay;\n\n}\n\nfunction getParents(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return [];\n  }\n\n  var parents = [];\n  var k, d, dep;\n\n  for (k in modules) {\n    for (d in modules[k][1]) {\n      dep = modules[k][1][d];\n      if (dep === id || (Array.isArray(dep) && dep[dep.length - 1] === id)) {\n        parents.push(k);\n      }\n    }\n  }\n\n  if (bundle.parent) {\n    parents = parents.concat(getParents(bundle.parent, id));\n  }\n\n  return parents;\n}\n\nfunction hmrApply(bundle, asset) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (modules[asset.id] || !bundle.parent) {\n    var fn = new Function('require', 'module', 'exports', asset.generated.js);\n    asset.isNew = !modules[asset.id];\n    modules[asset.id] = [fn, asset.deps];\n  } else if (bundle.parent) {\n    hmrApply(bundle.parent, asset);\n  }\n}\n\nfunction hmrAcceptCheck(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (!modules[id] && bundle.parent) {\n    return hmrAcceptCheck(bundle.parent, id);\n  }\n\n  if (checkedAssets[id]) {\n    return;\n  }\n  checkedAssets[id] = true;\n\n  var cached = bundle.cache[id];\n\n  assetsToAccept.push([bundle, id]);\n\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    return true;\n  }\n\n  return getParents(global.parcelRequire, id).some(function (id) {\n    return hmrAcceptCheck(global.parcelRequire, id)\n  });\n}\n\nfunction hmrAcceptRun(bundle, id) {\n  var cached = bundle.cache[id];\n  bundle.hotData = {};\n  if (cached) {\n    cached.hot.data = bundle.hotData;\n  }\n\n  if (cached && cached.hot && cached.hot._disposeCallbacks.length) {\n    cached.hot._disposeCallbacks.forEach(function (cb) {\n      cb(bundle.hotData);\n    });\n  }\n\n  delete bundle.cache[id];\n  bundle(id);\n\n  cached = bundle.cache[id];\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    cached.hot._acceptCallbacks.forEach(function (cb) {\n      cb();\n    });\n    return true;\n  }\n}\n"]}